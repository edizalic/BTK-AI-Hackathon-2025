(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[985],{229:(e,t,r)=>{"use strict";r.d(t,{CU:()=>c,UA:()=>o,fF:()=>d,q_:()=>i});var s=r(5155),n=r(2115),l=r(5695),a=r(1541);function i(e){let{children:t,requiredRoles:r=[],fallbackPath:i="/login",requireAuth:d=!0}=e,{user:o,isAuthenticated:c,isLoading:u}=(0,a.A)(),m=(0,l.useRouter)(),f=(0,l.usePathname)();return((0,n.useEffect)(()=>{if(!u){if(d&&!c){let e="/login"!==f?"?returnUrl=".concat(encodeURIComponent(f)):"";m.push("".concat(i).concat(e));return}if(c&&o&&r.length>0&&!r.includes(o.role)){switch(o.role){case"ADMIN":m.push("/admin-portal");break;case"SUPERVISOR_TEACHER":case"TEACHER":m.push("/teacher-portal");break;case"STUDENT":m.push("/student-portal");break;default:m.push("/")}return}}},[c,u,o,r,m,f,i,d]),u)?(0,s.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,s.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):d&&!c||c&&o&&r.length>0&&!r.includes(o.role)?null:(0,s.jsx)(s.Fragment,{children:t})}function d(e){let{children:t}=e;return(0,s.jsx)(i,{requiredRoles:["STUDENT"],children:t})}function o(e){let{children:t}=e;return(0,s.jsx)(i,{requiredRoles:["TEACHER","SUPERVISOR_TEACHER"],children:t})}function c(e){let{children:t}=e,{isAuthenticated:r,isLoading:i,user:d}=(0,a.A)(),o=(0,l.useRouter)();return((0,n.useEffect)(()=>{if(!i&&r&&d&&d.role){let e=setTimeout(()=>{let e="STUDENT"===d.role?"/student-portal":"TEACHER"===d.role||"SUPERVISOR_TEACHER"===d.role?"/teacher-portal":"ADMIN"===d.role?"/admin-portal":"/";window.location.href=e},500);return()=>clearTimeout(e)}},[r,i,d,o]),i)?(0,s.jsxs)("div",{className:"min-h-screen flex items-center justify-center",children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),(0,s.jsx)("p",{className:"ml-2 text-gray-600",children:"Loading the dashboard..."})]}):r&&d&&d.role?(0,s.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-4"}),(0,s.jsx)("p",{className:"text-gray-600",children:"Loading the dashboard..."})]})}):(0,s.jsx)(s.Fragment,{children:t})}},1121:(e,t,r)=>{"use strict";r.d(t,{S:()=>I});var s=r(5155),n=r(2115),l=r(6101),a=r(6081),i=r(5185),d=r(5845),o=r(5503),c=r(1275),u=r(8905),m=r(3655),f="Checkbox",[h,x]=(0,a.A)(f),[p,g]=h(f);function v(e){let{__scopeCheckbox:t,checked:r,children:l,defaultChecked:a,disabled:i,form:o,name:c,onCheckedChange:u,required:m,value:h="on",internal_do_not_use_render:x}=e,[g,v]=(0,d.i)({prop:r,defaultProp:null!=a&&a,onChange:u,caller:f}),[b,j]=n.useState(null),[N,y]=n.useState(null),E=n.useRef(!1),w=!b||!!o||!!b.closest("form"),k={checked:g,disabled:i,setChecked:v,control:b,setControl:j,name:c,form:o,value:h,hasConsumerStoppedPropagationRef:E,required:m,defaultChecked:!C(a)&&a,isFormControl:w,bubbleInput:N,setBubbleInput:y};return(0,s.jsx)(p,{scope:t,...k,children:"function"==typeof x?x(k):l})}var b="CheckboxTrigger",j=n.forwardRef((e,t)=>{let{__scopeCheckbox:r,onKeyDown:a,onClick:d,...o}=e,{control:c,value:u,disabled:f,checked:h,required:x,setControl:p,setChecked:v,hasConsumerStoppedPropagationRef:j,isFormControl:N,bubbleInput:y}=g(b,r),E=(0,l.s)(t,p),w=n.useRef(h);return n.useEffect(()=>{let e=null==c?void 0:c.form;if(e){let t=()=>v(w.current);return e.addEventListener("reset",t),()=>e.removeEventListener("reset",t)}},[c,v]),(0,s.jsx)(m.sG.button,{type:"button",role:"checkbox","aria-checked":C(h)?"mixed":h,"aria-required":x,"data-state":S(h),"data-disabled":f?"":void 0,disabled:f,value:u,...o,ref:E,onKeyDown:(0,i.m)(a,e=>{"Enter"===e.key&&e.preventDefault()}),onClick:(0,i.m)(d,e=>{v(e=>!!C(e)||!e),y&&N&&(j.current=e.isPropagationStopped(),j.current||e.stopPropagation())})})});j.displayName=b;var N=n.forwardRef((e,t)=>{let{__scopeCheckbox:r,name:n,checked:l,defaultChecked:a,required:i,disabled:d,value:o,onCheckedChange:c,form:u,...m}=e;return(0,s.jsx)(v,{__scopeCheckbox:r,checked:l,defaultChecked:a,disabled:d,required:i,onCheckedChange:c,name:n,form:u,value:o,internal_do_not_use_render:e=>{let{isFormControl:n}=e;return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(j,{...m,ref:t,__scopeCheckbox:r}),n&&(0,s.jsx)(k,{__scopeCheckbox:r})]})}})});N.displayName=f;var y="CheckboxIndicator",E=n.forwardRef((e,t)=>{let{__scopeCheckbox:r,forceMount:n,...l}=e,a=g(y,r);return(0,s.jsx)(u.C,{present:n||C(a.checked)||!0===a.checked,children:(0,s.jsx)(m.sG.span,{"data-state":S(a.checked),"data-disabled":a.disabled?"":void 0,...l,ref:t,style:{pointerEvents:"none",...e.style}})})});E.displayName=y;var w="CheckboxBubbleInput",k=n.forwardRef((e,t)=>{let{__scopeCheckbox:r,...a}=e,{control:i,hasConsumerStoppedPropagationRef:d,checked:u,defaultChecked:f,required:h,disabled:x,name:p,value:v,form:b,bubbleInput:j,setBubbleInput:N}=g(w,r),y=(0,l.s)(t,N),E=(0,o.Z)(u),k=(0,c.X)(i);n.useEffect(()=>{if(!j)return;let e=Object.getOwnPropertyDescriptor(window.HTMLInputElement.prototype,"checked").set,t=!d.current;if(E!==u&&e){let r=new Event("click",{bubbles:t});j.indeterminate=C(u),e.call(j,!C(u)&&u),j.dispatchEvent(r)}},[j,E,u,d]);let S=n.useRef(!C(u)&&u);return(0,s.jsx)(m.sG.input,{type:"checkbox","aria-hidden":!0,defaultChecked:null!=f?f:S.current,required:h,disabled:x,name:p,value:v,form:b,...a,tabIndex:-1,ref:y,style:{...a.style,...k,position:"absolute",pointerEvents:"none",opacity:0,margin:0,transform:"translateX(-100%)"}})});function C(e){return"indeterminate"===e}function S(e){return C(e)?"indeterminate":e?"checked":"unchecked"}k.displayName=w;let R=(0,r(9946).A)("check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);var A=r(9434);let I=n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,s.jsx)(N,{ref:t,className:(0,A.cn)("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",r),...n,children:(0,s.jsx)(E,{className:(0,A.cn)("flex items-center justify-center text-current"),children:(0,s.jsx)(R,{className:"h-4 w-4"})})})});I.displayName=N.displayName},1303:(e,t,r)=>{Promise.resolve().then(r.bind(r,6951))},2523:(e,t,r)=>{"use strict";r.d(t,{p:()=>a});var s=r(5155),n=r(2115),l=r(9434);let a=n.forwardRef((e,t)=>{let{className:r,type:n,...a}=e;return(0,s.jsx)("input",{type:n,className:(0,l.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",r),ref:t,...a})});a.displayName="Input"},5057:(e,t,r)=>{"use strict";r.d(t,{J:()=>o});var s=r(5155),n=r(2115),l=r(968),a=r(2085),i=r(9434);let d=(0,a.F)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),o=n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,s.jsx)(l.b,{ref:t,className:(0,i.cn)(d(),r),...n})});o.displayName=l.b.displayName},6126:(e,t,r)=>{"use strict";r.d(t,{E:()=>i});var s=r(5155);r(2115);var n=r(2085),l=r(9434);let a=(0,n.F)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function i(e){let{className:t,variant:r,...n}=e;return(0,s.jsx)("div",{className:(0,l.cn)(a({variant:r}),t),...n})}},6951:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>j});var s=r(5155),n=r(2115),l=r(5695),a=r(8950),i=r(4774),d=r(6695),o=r(285),c=r(2523),u=r(5057),m=r(1121),f=r(6126),h=r(229),x=r(1541),p=r(4247),g=r(9434),v=r(6874),b=r.n(v);function j(e){let{params:t}=e,r=(0,l.useRouter)(),{courseId:v}=(0,n.use)(t),{user:j}=(0,x.A)(),[N,y]=(0,n.useState)(null),[E,w]=(0,n.useState)([]),[k,C]=(0,n.useState)(!0),[S,R]=(0,n.useState)([]),[A,I]=(0,n.useState)(null),[T,_]=(0,n.useState)(""),[F,P]=(0,n.useState)(new Set),U={name:(null==j?void 0:j.profile)?"".concat(j.profile.firstName," ").concat(j.profile.lastName):"Loading...",email:(null==j?void 0:j.email)||""},D=(0,s.jsx)(i.Y,{userType:"teacher",userData:U});(0,n.useEffect)(()=>{let e=async()=>{try{var e,t,r;C(!0),I(null);let s=await p.nC.courses.getCourseById(v),n=s.data||s;if(y(n),!(null==(e=n.department)?void 0:e.name))throw Error("Course department information not available");let l=await p.nC.users.getAllStudents({limit:1e3});console.log("RAW STUDENTS RESPONSE:",JSON.stringify(l,null,2));let a=l.data||l,i=Array.isArray(a)?a:a.students||a,d=await fetch("".concat("https://vitriolacademy.com:76492","/enrollment/courses/").concat(v),{headers:{Authorization:"Bearer ".concat(localStorage.getItem("accessToken")),"Content-Type":"application/json"}});if(!d.ok)throw Error("Failed to fetch enrollments: ".concat(d.status));let o=await d.json(),c=(null==(t=o.data)?void 0:t.data)||(null==(r=o.data)?void 0:r.enrollments)||o.enrollments||o.data||o;if(!Array.isArray(i))throw Error("Invalid students data received from API");if(!Array.isArray(c))throw Error("Invalid enrolled students data received from API");let u=new Set(c.map(e=>e.studentId)),m=new Map,f=n.department.name;i.filter(e=>{var t;return(null==(t=e.profile)?void 0:t.major)===f}).forEach(e=>{var t,r;let s=(null==(t=e.profile)?void 0:t.major)||"No Department",n={...e,isEnrolled:u.has(e.id),enrollmentId:null==(r=c.find(t=>t.studentId===e.id))?void 0:r.id};m.has(s)||m.set(s,[]),m.get(s).push(n)});let h=Array.from(m.entries()).map(e=>{let[t,r]=e;return{departmentName:t,students:r.sort((e,t)=>{var r,s,n,l;return"".concat(null==(r=e.profile)?void 0:r.firstName," ").concat(null==(s=e.profile)?void 0:s.lastName).localeCompare("".concat(null==(n=t.profile)?void 0:n.firstName," ").concat(null==(l=t.profile)?void 0:l.lastName))})}}).sort((e,t)=>e.departmentName.localeCompare(t.departmentName));w(h)}catch(e){console.error("Error loading enrollment data:",e),I(e instanceof Error?e.message:"Failed to load enrollment data")}finally{C(!1)}};v&&e()},[v]);let O=async e=>{if(!S.includes(e.id))try{R(t=>[...t,e.id]),e.isEnrolled?await p.nC.courses.unenrollStudent(v,e.id):await p.nC.courses.enrollStudent(v,{studentId:e.id}),w(t=>t.map(t=>({...t,students:t.students.map(t=>t.id===e.id?{...t,isEnrolled:!t.isEnrolled}:t)})))}catch(e){console.error("Error toggling enrollment:",e),I(e instanceof Error?e.message:"Failed to update enrollment")}finally{R(t=>t.filter(t=>t!==e.id))}},B=async()=>{if(0!==F.size)try{R(e=>[...e,...Array.from(F)]);let e=Array.from(F);console.log("Bulk enrolling students:",e);let t=await fetch("".concat("https://vitriolacademy.com:76492","/enrollment/courses/").concat(v,"/bulk-enroll"),{method:"POST",headers:{Authorization:"Bearer ".concat(localStorage.getItem("accessToken")),"Content-Type":"application/json"},body:JSON.stringify({studentIds:e})});if(!t.ok)throw Error("Bulk enrollment failed: ".concat(t.status," ").concat(t.statusText));let r=await t.json();console.log("Bulk enrollment result:",r),w(e=>e.map(e=>({...e,students:e.students.map(e=>F.has(e.id)?{...e,isEnrolled:!0}:e)}))),P(new Set)}catch(e){console.error("Bulk enrollment error details:",e),I(e instanceof Error?e.message:"Failed to bulk enroll students")}finally{R(e=>e.filter(e=>!F.has(e)))}},L=E.map(e=>({...e,students:e.students.filter(e=>{var t,r,s,n;let l="".concat((null==(t=e.profile)?void 0:t.firstName)||""," ").concat((null==(r=e.profile)?void 0:r.lastName)||"").toLowerCase(),a=e.email.toLowerCase(),i=(null==(n=e.profile)||null==(s=n.studentId)?void 0:s.toLowerCase())||"",d=T.toLowerCase();return l.includes(d)||a.includes(d)||i.includes(d)})})).filter(e=>e.students.length>0);if(k)return(0,s.jsx)(a.CF,{drawerContent:D,children:(0,s.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-gray-900"}),(0,s.jsx)("p",{className:"mt-4 text-gray-600",children:"Loading enrollment data..."})]})})});if(A||!N)return(0,s.jsx)(a.CF,{drawerContent:D,children:(0,s.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("h1",{className:"text-2xl font-bold text-red-600 mb-2",children:"Error"}),(0,s.jsx)("p",{className:"text-gray-600 mb-4",children:A||"Failed to load enrollment data"}),(0,s.jsx)(o.$,{onClick:()=>r.push("/courses/".concat(v)),children:"Back to Course"})]})})});let z=E.reduce((e,t)=>e+t.students.length,0),H=E.reduce((e,t)=>e+t.students.filter(e=>e.isEnrolled).length,0),Z=E.reduce((e,t)=>e+t.students.filter(e=>!e.isEnrolled).length,0);return(0,s.jsx)(h.q_,{requiredRoles:["SUPERVISOR_TEACHER"],children:(0,s.jsx)(a.CF,{drawerContent:D,children:(0,s.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-indigo-50 to-purple-100 dark:from-slate-900 dark:to-slate-800",children:(0,s.jsxs)("div",{className:"max-w-7xl mx-auto p-6 space-y-8",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(b(),{href:"/courses/".concat(v),children:(0,s.jsx)(o.$,{variant:"outline",size:"sm",children:"← Back to Course"})}),(0,s.jsx)("h1",{className:"text-3xl font-bold text-foreground mt-4",children:"Enroll Students"}),(0,s.jsxs)("p",{className:"text-muted-foreground",children:[N.name," (",N.code,")"]})]}),(0,s.jsxs)("div",{className:"text-right",children:[(0,s.jsx)("div",{className:"text-sm text-muted-foreground",children:"Course Capacity"}),(0,s.jsxs)("div",{className:"text-2xl font-bold",children:[H,"/",N.capacity]})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[(0,s.jsx)(d.Zp,{children:(0,s.jsxs)(d.Wu,{className:"p-6",children:[(0,s.jsx)("div",{className:"text-2xl font-bold text-blue-600",children:z}),(0,s.jsx)("p",{className:"text-muted-foreground",children:"Total Students"})]})}),(0,s.jsx)(d.Zp,{children:(0,s.jsxs)(d.Wu,{className:"p-6",children:[(0,s.jsx)("div",{className:"text-2xl font-bold text-green-600",children:H}),(0,s.jsx)("p",{className:"text-muted-foreground",children:"Enrolled"})]})}),(0,s.jsx)(d.Zp,{children:(0,s.jsxs)(d.Wu,{className:"p-6",children:[(0,s.jsx)("div",{className:"text-2xl font-bold text-orange-600",children:Z}),(0,s.jsx)("p",{className:"text-muted-foreground",children:"Available to Enroll"})]})})]}),(0,s.jsx)(d.Zp,{children:(0,s.jsx)(d.Wu,{className:"p-6",children:(0,s.jsxs)("div",{className:"flex flex-col md:flex-row gap-4 items-start md:items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex-1 max-w-md",children:[(0,s.jsx)(u.J,{htmlFor:"search",children:"Search Students"}),(0,s.jsx)(c.p,{id:"search",placeholder:"Search by name, email, or student ID...",value:T,onChange:e=>_(e.target.value)})]}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsxs)(o.$,{variant:"outline",onClick:()=>P(new Set),disabled:0===F.size,children:["Clear Selection (",F.size,")"]}),(0,s.jsxs)(o.$,{onClick:B,disabled:0===F.size||S.length>0,children:["Enroll Selected (",F.size,")"]})]})]})})}),(0,s.jsx)("div",{className:"space-y-6",children:L.map(e=>(0,s.jsxs)(d.Zp,{children:[(0,s.jsx)(d.aR,{children:(0,s.jsxs)(d.ZB,{className:"flex items-center justify-between",children:[(0,s.jsx)("span",{children:e.departmentName}),(0,s.jsxs)(f.E,{variant:"outline",children:[e.students.filter(e=>e.isEnrolled).length,"/",e.students.length," enrolled"]})]})}),(0,s.jsx)(d.Wu,{children:(0,s.jsx)("div",{className:"space-y-2",children:e.students.map(e=>{var t,r,n,l,a,i,d;return(0,s.jsxs)("div",{className:(0,g.cn)("flex items-center justify-between p-3 rounded-lg border",e.isEnrolled?"bg-green-50 border-green-200 dark:bg-green-900/20 dark:border-green-800":"bg-gray-50 border-gray-200 dark:bg-gray-800 dark:border-gray-700"),children:[(0,s.jsxs)("div",{className:"flex items-center space-x-3",children:[!e.isEnrolled&&(0,s.jsx)(m.S,{checked:F.has(e.id),onCheckedChange:t=>{let r=new Set(F);t?r.add(e.id):r.delete(e.id),P(r)}}),(0,s.jsx)("div",{className:"w-10 h-10 bg-blue-500 rounded-full flex items-center justify-center text-white font-semibold",children:"".concat((null==(r=e.profile)||null==(t=r.firstName)?void 0:t[0])||"").concat((null==(l=e.profile)||null==(n=l.lastName)?void 0:n[0])||"")||e.email[0].toUpperCase()}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("p",{className:"font-semibold",children:[null==(a=e.profile)?void 0:a.firstName," ",null==(i=e.profile)?void 0:i.lastName]}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:e.email}),(null==(d=e.profile)?void 0:d.studentId)&&(0,s.jsxs)("p",{className:"text-xs text-muted-foreground",children:["ID: ",e.profile.studentId]})]})]}),(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[e.isEnrolled?(0,s.jsx)(f.E,{variant:"default",className:"bg-green-600",children:"Enrolled"}):(0,s.jsx)(f.E,{variant:"outline",children:"Not Enrolled"}),(0,s.jsx)(o.$,{variant:e.isEnrolled?"destructive":"default",size:"sm",onClick:()=>O(e),disabled:S.includes(e.id),children:S.includes(e.id)?(0,s.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}):e.isEnrolled?"Unenroll":"Enroll"})]})]},e.id)})})})]},e.departmentName))}),0===L.length&&(0,s.jsx)(d.Zp,{children:(0,s.jsx)(d.Wu,{className:"p-12 text-center",children:(0,s.jsx)("p",{className:"text-muted-foreground",children:"No students found matching your search."})})})]})})})})}}},e=>{e.O(0,[874,794,352,423,541,828,441,964,358],()=>e(e.s=1303)),_N_E=e.O()}]);