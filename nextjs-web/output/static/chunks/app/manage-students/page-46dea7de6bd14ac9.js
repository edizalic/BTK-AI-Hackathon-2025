(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[307],{229:(e,s,t)=>{"use strict";t.d(s,{CU:()=>c,UA:()=>i,fF:()=>o,q_:()=>d});var r=t(5155),a=t(2115),l=t(5695),n=t(1541);function d(e){let{children:s,requiredRoles:t=[],fallbackPath:d="/login",requireAuth:o=!0}=e,{user:i,isAuthenticated:c,isLoading:u}=(0,n.A)(),x=(0,l.useRouter)(),m=(0,l.usePathname)();return((0,a.useEffect)(()=>{if(!u){if(o&&!c){let e="/login"!==m?"?returnUrl=".concat(encodeURIComponent(m)):"";x.push("".concat(d).concat(e));return}if(c&&i&&t.length>0&&!t.includes(i.role)){switch(i.role){case"ADMIN":x.push("/admin-portal");break;case"SUPERVISOR_TEACHER":case"TEACHER":x.push("/teacher-portal");break;case"STUDENT":x.push("/student-portal");break;default:x.push("/")}return}}},[c,u,i,t,x,m,d,o]),u)?(0,r.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,r.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):o&&!c||c&&i&&t.length>0&&!t.includes(i.role)?null:(0,r.jsx)(r.Fragment,{children:s})}function o(e){let{children:s}=e;return(0,r.jsx)(d,{requiredRoles:["STUDENT"],children:s})}function i(e){let{children:s}=e;return(0,r.jsx)(d,{requiredRoles:["TEACHER","SUPERVISOR_TEACHER"],children:s})}function c(e){let{children:s}=e,{isAuthenticated:t,isLoading:d,user:o}=(0,n.A)(),i=(0,l.useRouter)();return((0,a.useEffect)(()=>{if(!d&&t&&o&&o.role){let e=setTimeout(()=>{let e="STUDENT"===o.role?"/student-portal":"TEACHER"===o.role||"SUPERVISOR_TEACHER"===o.role?"/teacher-portal":"ADMIN"===o.role?"/admin-portal":"/";window.location.href=e},500);return()=>clearTimeout(e)}},[t,d,o,i]),d)?(0,r.jsxs)("div",{className:"min-h-screen flex items-center justify-center",children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),(0,r.jsx)("p",{className:"ml-2 text-gray-600",children:"Loading the dashboard..."})]}):t&&o&&o.role?(0,r.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-4"}),(0,r.jsx)("p",{className:"text-gray-600",children:"Loading the dashboard..."})]})}):(0,r.jsx)(r.Fragment,{children:s})}},968:(e,s,t)=>{"use strict";t.d(s,{b:()=>d});var r=t(2115),a=t(3655),l=t(5155),n=r.forwardRef((e,s)=>(0,l.jsx)(a.sG.label,{...e,ref:s,onMouseDown:s=>{var t;s.target.closest("button, input, select, textarea")||(null==(t=e.onMouseDown)||t.call(e,s),!s.defaultPrevented&&s.detail>1&&s.preventDefault())}}));n.displayName="Label";var d=n},2523:(e,s,t)=>{"use strict";t.d(s,{p:()=>n});var r=t(5155),a=t(2115),l=t(9434);let n=a.forwardRef((e,s)=>{let{className:t,type:a,...n}=e;return(0,r.jsx)("input",{type:a,className:(0,l.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",t),ref:s,...n})});n.displayName="Input"},2653:(e,s,t)=>{Promise.resolve().then(t.bind(t,9705))},3655:(e,s,t)=>{"use strict";t.d(s,{sG:()=>n});var r=t(2115);t(7650);var a=t(9708),l=t(5155),n=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"].reduce((e,s)=>{let t=(0,a.TL)(`Primitive.${s}`),n=r.forwardRef((e,r)=>{let{asChild:a,...n}=e;return"undefined"!=typeof window&&(window[Symbol.for("radix-ui")]=!0),(0,l.jsx)(a?t:s,{...n,ref:r})});return n.displayName=`Primitive.${s}`,{...e,[s]:n}},{})},5057:(e,s,t)=>{"use strict";t.d(s,{J:()=>i});var r=t(5155),a=t(2115),l=t(968),n=t(2085),d=t(9434);let o=(0,n.F)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),i=a.forwardRef((e,s)=>{let{className:t,...a}=e;return(0,r.jsx)(l.b,{ref:s,className:(0,d.cn)(o(),t),...a})});i.displayName=l.b.displayName},9705:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>p});var r=t(5155),a=t(2115),l=t(285),n=t(2523),d=t(5057),o=t(6695),i=t(8950),c=t(4774),u=t(229),x=t(1541),m=t(4247),h=t(6977);function p(){var e,s,t;let{user:p}=(0,x.A)(),f=(null==p||null==(e=p.profile)?void 0:e.department)||"Computer Science",[b,j]=(0,a.useState)([]),[N,g]=(0,a.useState)(!0),[w,v]=(0,a.useState)(null),[y,k]=(0,a.useState)(null),[P,E]=(0,a.useState)(!1),[S,R]=(0,a.useState)({newPassword:"",confirmPassword:""});(0,a.useEffect)(()=>{if(y){let e=setTimeout(()=>{k(null)},1e4);return()=>clearTimeout(e)}},[y]),(0,a.useEffect)(()=>{f&&C()},[f]);let C=async()=>{try{g(!0),console.log("=== FETCHING STUDENTS FOR MANAGEMENT ==="),console.log("Supervisor department:",f);let e=await m.nC.users.getUsers({role:h.gG.STUDENT});console.log("Students API response:",e);let s=e.users||[];console.log("Students array:",s),console.log("Number of students found:",s.length);let t=s.filter(e=>{var s;let t=null==(s=e.profile)?void 0:s.major,r=t===f;return console.log("Student ".concat(e.email,': major="').concat(t,'", supervisor dept="').concat(f,'", matches=').concat(r)),r});console.log("Students after filtering by major:",t.length),console.log("Filtered students:",t),j(t)}catch(e){console.error("Failed to fetch students:",e),k({type:"error",text:"Failed to load students list"})}finally{g(!1)}},T=b.reduce((e,s)=>{var t;let r=(null==(t=s.profile)?void 0:t.grade)||"Unassigned";return e[r]||(e[r]=[]),e[r].push(s),e},{}),D=Object.keys(T).sort((e,s)=>{let t=["1","2","3","4"],r=t.indexOf(e),a=t.indexOf(s);return -1!==r&&-1!==a?r-a:-1!==r?-1:-1!==a?1:e.localeCompare(s)}),M=e=>{let{name:s,value:t}=e.target;R(e=>({...e,[s]:t}))},A=async e=>{if(e.preventDefault(),w){if(!S.newPassword||S.newPassword.length<8)return void k({type:"error",text:"Password must be at least 8 characters long"});if(S.newPassword!==S.confirmPassword)return void k({type:"error",text:"Passwords do not match"});try{var s,t;E(!0);let e={newPassword:S.newPassword};await m.nC.auth.resetPassword(w.id,e),v(null),R({newPassword:"",confirmPassword:""}),k({type:"success",text:"Password reset successfully for ".concat(null==(s=w.profile)?void 0:s.firstName," ").concat(null==(t=w.profile)?void 0:t.lastName,". New password: ").concat(S.newPassword)})}catch(e){console.error("Failed to reset password:",e),k({type:"error",text:"Failed to reset password"})}finally{E(!1)}}},F=async(e,s)=>{if(confirm("Are you sure you want to delete ".concat(s,"? This action cannot be undone.")))try{await m.nC.users.deleteUser(e),await C(),k({type:"success",text:"Student deleted successfully"})}catch(e){console.error("Failed to delete student:",e),k({type:"error",text:"Failed to delete student"})}},U={name:(null==p?void 0:p.profile)?"".concat(p.profile.firstName," ").concat(p.profile.lastName):"Loading...",email:(null==p?void 0:p.email)||""},I=(0,r.jsx)(c.Y,{userType:"teacher",userData:U});return(0,r.jsx)(u.q_,{requiredRoles:["SUPERVISOR_TEACHER"],children:(0,r.jsx)(i.CF,{drawerContent:I,children:(0,r.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 dark:from-slate-900 dark:to-slate-800",children:[(0,r.jsxs)("div",{className:"max-w-7xl mx-auto p-6",children:[(0,r.jsxs)("div",{className:"mb-8",children:[(0,r.jsx)("h1",{className:"text-3xl font-bold text-slate-900 dark:text-white",children:"Manage Students"}),(0,r.jsxs)("p",{className:"text-slate-600 dark:text-slate-300",children:["Manage students in your department (",f,")"]})]}),y&&(0,r.jsx)(o.Zp,{className:"mb-6 ".concat("success"===y.type?"border-green-200 bg-green-50 dark:bg-green-900/20":"border-red-200 bg-red-50 dark:bg-red-900/20"),children:(0,r.jsx)(o.Wu,{className:"p-4",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("p",{className:"text-sm ".concat("success"===y.type?"text-green-800 dark:text-green-200":"text-red-800 dark:text-red-200"),children:y.text}),(0,r.jsx)(l.$,{variant:"ghost",size:"sm",onClick:()=>k(null),className:"ml-4",children:"✕"})]})})}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4 mb-8",children:[(0,r.jsx)(o.Zp,{className:"bg-blue-50 dark:bg-blue-900/20 border-blue-200 dark:border-blue-800",children:(0,r.jsxs)(o.Wu,{className:"p-4 text-center",children:[(0,r.jsx)("div",{className:"text-2xl font-bold text-blue-600 dark:text-blue-400",children:N?"...":b.length}),(0,r.jsx)("div",{className:"text-sm text-blue-600/80 dark:text-blue-400/80",children:"Total Students"})]})}),["1","2","3","4"].map(e=>{var s;return(0,r.jsx)(o.Zp,{className:"bg-green-50 dark:bg-green-900/20 border-green-200 dark:border-green-800",children:(0,r.jsxs)(o.Wu,{className:"p-4 text-center",children:[(0,r.jsx)("div",{className:"text-2xl font-bold text-green-600 dark:text-green-400",children:N?"...":(null==(s=T[e])?void 0:s.length)||0}),(0,r.jsxs)("div",{className:"text-sm text-green-600/80 dark:text-green-400/80",children:["Grade ",e]})]})},e)})]}),N?(0,r.jsx)(o.Zp,{children:(0,r.jsx)(o.Wu,{className:"p-8 text-center",children:(0,r.jsxs)("div",{className:"flex items-center justify-center space-x-2",children:[(0,r.jsx)("div",{className:"w-6 h-6 border-2 border-blue-600 border-t-transparent rounded-full animate-spin"}),(0,r.jsx)("span",{className:"text-slate-600 dark:text-slate-400",children:"Loading students..."})]})})}):(0,r.jsxs)("div",{className:"space-y-6",children:[D.map(e=>(0,r.jsxs)(o.Zp,{children:[(0,r.jsx)(o.aR,{children:(0,r.jsxs)(o.ZB,{className:"flex items-center space-x-2",children:[(0,r.jsx)("span",{className:"text-2xl",children:"1"===e?"\uD83C\uDF93":"2"===e?"\uD83D\uDCDA":"3"===e?"\uD83C\uDFAF":"4"===e?"\uD83D\uDC68‍\uD83C\uDF93":"❓"}),(0,r.jsx)("span",{children:"Unassigned"===e?"Unassigned Grade":"Grade ".concat(e)}),(0,r.jsxs)("span",{className:"text-sm bg-blue-100 dark:bg-blue-900/30 px-2 py-1 rounded",children:[T[e].length," students"]})]})}),(0,r.jsx)(o.Wu,{children:(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)("table",{className:"w-full",children:[(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{className:"border-b border-slate-200 dark:border-slate-700",children:[(0,r.jsx)("th",{className:"text-left py-3 px-4 font-medium text-slate-900 dark:text-slate-100",children:"Name"}),(0,r.jsx)("th",{className:"text-left py-3 px-4 font-medium text-slate-900 dark:text-slate-100",children:"Email"}),(0,r.jsx)("th",{className:"text-left py-3 px-4 font-medium text-slate-900 dark:text-slate-100",children:"Student ID"}),(0,r.jsx)("th",{className:"text-left py-3 px-4 font-medium text-slate-900 dark:text-slate-100",children:"Major"}),(0,r.jsx)("th",{className:"text-left py-3 px-4 font-medium text-slate-900 dark:text-slate-100",children:"Minor"}),(0,r.jsx)("th",{className:"text-left py-3 px-4 font-medium text-slate-900 dark:text-slate-100",children:"Actions"})]})}),(0,r.jsx)("tbody",{children:T[e].map(e=>{var s,t,a,n,d;return(0,r.jsxs)("tr",{className:"border-b border-slate-100 dark:border-slate-800 hover:bg-slate-50 dark:hover:bg-slate-800/50",children:[(0,r.jsx)("td",{className:"py-3 px-4",children:(0,r.jsxs)("div",{className:"font-medium text-slate-900 dark:text-slate-100",children:[null==(s=e.profile)?void 0:s.firstName," ",null==(t=e.profile)?void 0:t.lastName]})}),(0,r.jsx)("td",{className:"py-3 px-4",children:(0,r.jsx)("span",{className:"font-mono text-sm bg-blue-100 dark:bg-blue-900/30 px-2 py-1 rounded",children:e.email})}),(0,r.jsx)("td",{className:"py-3 px-4",children:(0,r.jsx)("span",{className:"font-mono text-sm bg-gray-100 dark:bg-gray-900/30 px-2 py-1 rounded",children:(null==(a=e.profile)?void 0:a.studentId)||"N/A"})}),(0,r.jsx)("td",{className:"py-3 px-4",children:(0,r.jsx)("span",{className:"text-sm text-slate-600 dark:text-slate-400",children:(null==(n=e.profile)?void 0:n.major)||"N/A"})}),(0,r.jsx)("td",{className:"py-3 px-4",children:(0,r.jsx)("span",{className:"text-sm text-slate-600 dark:text-slate-400",children:(null==(d=e.profile)?void 0:d.minor)||"None"})}),(0,r.jsx)("td",{className:"py-3 px-4",children:(0,r.jsxs)("div",{className:"flex space-x-2",children:[(0,r.jsx)(l.$,{variant:"outline",size:"sm",onClick:()=>{v(e),R({newPassword:"",confirmPassword:""})},className:"text-xs px-3 py-1 bg-blue-50 hover:bg-blue-100 text-blue-700 border-blue-200",children:"\uD83D\uDD11 Reset Password"}),(0,r.jsx)(l.$,{variant:"destructive",size:"sm",onClick:()=>{var s,t;return F(e.id,"".concat(null==(s=e.profile)?void 0:s.firstName," ").concat(null==(t=e.profile)?void 0:t.lastName))},className:"text-xs px-3 py-1",children:"Delete"})]})})]},e.id)})})]})})})]},e)),0===b.length&&(0,r.jsx)(o.Zp,{children:(0,r.jsx)(o.Wu,{className:"p-8 text-center",children:(0,r.jsxs)("div",{className:"text-slate-500 dark:text-slate-400",children:[(0,r.jsx)("div",{className:"text-4xl mb-4",children:"\uD83C\uDF93"}),(0,r.jsx)("h3",{className:"text-lg font-medium mb-2",children:"No Students Found"}),(0,r.jsx)("p",{className:"text-sm",children:"No students are registered in your department yet."})]})})})]})]}),w&&(0,r.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:(0,r.jsxs)(o.Zp,{className:"w-full max-w-md",children:[(0,r.jsxs)(o.aR,{children:[(0,r.jsxs)(o.ZB,{className:"flex items-center space-x-2",children:[(0,r.jsx)("span",{children:"\uD83D\uDD11"}),(0,r.jsx)("span",{children:"Reset Password"})]}),(0,r.jsxs)(o.BT,{children:["Reset password for ",null==(s=w.profile)?void 0:s.firstName," ",null==(t=w.profile)?void 0:t.lastName]})]}),(0,r.jsx)(o.Wu,{children:(0,r.jsxs)("form",{onSubmit:A,className:"space-y-4",children:[(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(d.J,{htmlFor:"new-password",children:"New Password"}),(0,r.jsx)(n.p,{id:"new-password",name:"newPassword",type:"text",placeholder:"Enter new password (min 8 characters)",value:S.newPassword,onChange:M,required:!0,minLength:8,className:"font-mono"})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(d.J,{htmlFor:"confirm-password",children:"Confirm Password"}),(0,r.jsx)(n.p,{id:"confirm-password",name:"confirmPassword",type:"text",placeholder:"Confirm new password",value:S.confirmPassword,onChange:M,required:!0,minLength:8,className:"font-mono"})]}),(0,r.jsx)("div",{className:"flex justify-center",children:(0,r.jsx)(l.$,{type:"button",variant:"outline",onClick:()=>{let e=(()=>{let e="ABCDEFGHIJKLMNOPQRSTUVWXYZ",s="abcdefghijklmnopqrstuvwxyz",t="0123456789",r="!@#$%^&*",a="";a+=e[Math.floor(Math.random()*e.length)],a+=s[Math.floor(Math.random()*s.length)],a+=t[Math.floor(Math.random()*t.length)],a+=r[Math.floor(Math.random()*r.length)];let l=e+s+t+r;for(let e=4;e<12;e++)a+=l[Math.floor(Math.random()*l.length)];return a.split("").sort(()=>Math.random()-.5).join("")})();R({newPassword:e,confirmPassword:e})},className:"text-sm",children:"\uD83C\uDFB2 Generate Secure Password"})}),S.newPassword&&S.confirmPassword&&(0,r.jsx)("div",{className:"p-3 bg-blue-50 dark:bg-blue-900/20 rounded-md",children:(0,r.jsx)("p",{className:"text-sm text-blue-700 dark:text-blue-300",children:S.newPassword===S.confirmPassword?(0,r.jsxs)("span",{className:"flex items-center",children:[(0,r.jsx)("span",{className:"text-green-600 mr-2",children:"✅"}),"Passwords match"]}):(0,r.jsxs)("span",{className:"flex items-center",children:[(0,r.jsx)("span",{className:"text-red-600 mr-2",children:"❌"}),"Passwords do not match"]})})})]})}),(0,r.jsxs)(o.wL,{className:"flex justify-end space-x-2",children:[(0,r.jsx)(l.$,{variant:"outline",onClick:()=>v(null),disabled:P,children:"Cancel"}),(0,r.jsx)(l.$,{onClick:A,className:"bg-blue-600 hover:bg-blue-700",disabled:P||!S.newPassword||S.newPassword!==S.confirmPassword,children:P?(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),(0,r.jsx)("span",{children:"Resetting..."})]}):"Reset Password"})]})]})})]})})})}}},e=>{e.O(0,[874,794,352,541,828,441,964,358],()=>e(e.s=2653)),_N_E=e.O()}]);